/**
 * Automatically generated by QHGC tool
 * @date: {{time}}
 */
import React, {useEffect} from "react";
import {PageContainer} from "@ant-design/pro-layout";
import {Form, Card, Modal} from "antd";
import {history} from 'umi';
import YunReact from "@/utils/YunReact";
import EditForm from "./components/EditForm";
import api from "./service/api";
{{import}}

/**
 * 更新页面主函数
 * @returns {JSX.Element}
 * @constructor
 */
const Index = (props) => {

  const [form] = Form.useForm();

  const key = props.location.query.id;

  useEffect(() => {
    if (key) {
      YunReact.fetchGet(api.detail, {{{primary}}: key}, (res) => {
        form.setFieldsValue(res);
      })
    }
  }, [])

  return (
    <PageContainer>
      <Card bordered={false}>
        <EditForm
          form={form}
          onFinish={onFinish}
        />
      </Card>
    </PageContainer>
  )

  // 表单提交
  function onFinish(values) {
    YunReact.fetchPost(api.update, {
      {{primary}}: key,
      ...values
    }, () => {
      Modal.success({
        title: '更新成功',
        onOk: () => {
          history.goBack();
        }
      });
    })
  }
}

export default Index;
